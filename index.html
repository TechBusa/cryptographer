<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encryption & Decryption Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tool-container {
            transition: all 0.3s ease-in-out;
        }
        .tool-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            transform: scale(1.05);
        }
        .result-box {
            min-height: 128px; /* 8rem */
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .file-input-label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
        }
        .icon-btn {
             background: none;
             border: none;
             cursor: pointer;
             padding: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold text-gray-800 dark:text-white">Cipher Tool</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Encrypt, Decrypt, and Analyze classic ciphers.</p>
        </header>

        <div class="relative flex flex-col lg:flex-row items-center justify-center gap-8">
            <!-- Encryption Tool -->
            <div id="encrypt-container" class="w-full bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md tool-container">
                <h2 class="text-2xl font-bold mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">Encrypt / Encode</h2>
                <div class="space-y-4">
                    <div>
                        <label for="encrypt-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Text to Process:</label>
                        <textarea id="encrypt-text" rows="4" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>
                     <div>
                        <label for="encrypt-file-input" class="file-input-label block text-sm font-medium text-center text-indigo-600 dark:text-indigo-400 bg-indigo-100 dark:bg-gray-700 hover:bg-indigo-200 dark:hover:bg-gray-600">
                            Or Upload a File
                        </label>
                        <input type="file" id="encrypt-file-input" class="hidden">
                        <span id="encrypt-file-name" class="text-sm text-gray-500 dark:text-gray-400 mt-1 block"></span>
                    </div>
                    <div>
                        <label for="encrypt-method" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Method:</label>
                        <select id="encrypt-method" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <option value="caesar">Caesar Cipher</option>
                            <option value="substitution">Substitution Cipher</option>
                            <option value="vigenere">Vigenère Cipher</option>
                            <option value="atbash">Atbash Cipher</option>
                            <option value="morse">Morse Code</option>
                        </select>
                    </div>
                    <div id="encrypt-key-container">
                        <label for="encrypt-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Key (Shift for Caesar):</label>
                        <div class="flex items-center gap-2 mt-1">
                            <input type="text" id="encrypt-key" value="3" class="block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <button id="generate-encrypt-key" class="hidden p-2 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500" title="Generate Random Key">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.261.43.392.86.392 1.29 0 .43-.13.86-.392 1.29a3.37 3.37 0 0 1-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A2.37 2.37 0 0 0 5.624 8.5c0-.596.246-1.15.658-1.568C7.173 5.01 8.548 4 10.348 4H15.5a.5.5 0 0 1 0 1h-5.152c-1.802 0-3.177 1.01-4.123 2.082a2.37 2.37 0 0 0-.657 1.568c0 .596.246 1.15.657 1.568C7.177 10.99 8.552 12 10.352 12H11.5a.5.5 0 0 1 0 1h-1.152c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 4.376 9.21c-.261-.43-.392-.86-.392-1.29 0 .43.13.86.392-1.29C4.938 6.19 5.312 5.64 5.803 5.088 6.757 4.01 8.132 3 10 3h.5a.5.5 0 0 1 0 1H10c-1.798 0-3.173-1.01-4.126 2.082A2.37 2.37 0 0 0 5.376 7.5c0 .596.246 1.15.658 1.568C6.827 9.99 8.202 11 10 11h.5a.5.5 0 0 1 0 1H10c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 4.002 8.71c-.261-.43-.392-.86-.392-1.29s.13-.86.392-1.29c.26-.43.635-.98 1.126-1.532C6.173 3.24 7.798 2 10 2h5.5a.5.5 0 0 1 0 1H10c-1.802 0-3.177 1.01-4.123 2.082A2.37 2.37 0 0 0 5.22 6.432c0 .596.246 1.15.657 1.568C6.723 8.99 8.098 10 9.898 10H15.5a.5.5 0 0 1 0 1h-5.602c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 3.898 7.21c-.261-.43-.392-.86-.392-1.29 0-.43.13-.86.392-1.29C4.158 4.19 4.532 3.64 5.024 3.088 5.977 2.01 7.352 1 9.152 1H15.5a.5.5 0 0 1 0 1h-6.348c-1.798 0-3.173-1.01-4.126 2.082A2.37 2.37 0 0 0 4.376 5.5c0 .596.246 1.15.658 1.568C5.827 7.99 7.202 9 9 9h.5a.5.5 0 0 1 0 1H9c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 3.002 6.21c-.261-.43-.392-.86-.392-1.29s.13-.86.392-1.29C3.258 3.19 3.632 2.64 4.124 2.088 5.077 1.01 6.452 0 8.252 0H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V.5H8.252C6.452.5 5.077 1.51 4.124 2.582A2.37 2.37 0 0 0 3.468 4.15c-.246.412-.369.86-.369 1.35 0 .49.123.938.369 1.35a2.37 2.37 0 0 0 .656 1.568C5.077 9.49 6.452 10.5 8.252 10.5H9.5a.5.5 0 0 1 0 1h-1.248c-1.8 0-3.175-1.01-4.123-2.082a2.37 2.37 0 0 0-.657-1.568c-.246-.412-.369-.86-.369-1.35 0-.49.123-.938.369-1.35a2.37 2.37 0 0 0 .657-1.568C5.075 3.51 6.45 2.5 8.25 2.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V3.5h-7.25c-1.8 0-3.175-1.01-4.123 2.082A2.37 2.37 0 0 0 3.47 7.15c-.246.412-.369.86-.369 1.35 0 .49.123.938.369 1.35a2.37 2.37 0 0 0 .656 1.568C5.075 12.49 6.45 13.5 8.25 13.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-.5H8.25c-1.8 0-3.175-1.01-4.123-2.082A2.37 2.37 0 0 0 3.47 9.85c-.246-.412-.369-.86-.369-1.35 0-.49.123-.938.369-1.35a2.37 2.37 0 0 0 .656-1.568C5.075 5.51 6.45 4.5 8.25 4.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5h-7.25c-2.202 0-3.827 1.24-4.874 2.418A3.37 3.37 0 0 1 2.25 9.21c-.261.43-.392.86-.392-1.29 0 .43.13.86.392 1.29.26.43.635.98 1.126 1.532C4.173 14.76 5.798 16 8 16h7.5a.5.5 0 0 1 .5-.5v-1a.5.5 0 0 1 1 0v1a1.5 1.5 0 0 1-1.5 1.5H8c-2.761 0-4.764-1.67-5.952-3.048A4.37 4.37 0 0 1 .75 9.21c0-.615.17-1.215.5-1.756C2.125 6.01 3.927 4.5 6.5 4.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5H6.5c-2.573 0-4.375 1.51-5.25 2.956C.82 9.17.5 10.036.5 11a2.5 2.5 0 0 0 2.5 2.5h10.5a.5.5 0 0 1 0 1H3a3.5 3.5 0 0 1-3.5-3.5c0-1.18.34-2.274.968-3.218C1.453 6.01 3.251 4.5 6 4.5h9.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5H6c-2.761 0-4.764-1.67-5.952-3.048A4.37 4.37 0 0 1 0 3.5z"/></svg>
                            </button>
                        </div>
                    </div>
                    <button id="encrypt-btn" class="w-full btn-primary bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Process
                    </button>
                    <div>
                        <div class="flex justify-between items-center">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Result:</label>
                            <button id="copy-encrypt" class="icon-btn text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" title="Copy to Clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                            </button>
                        </div>
                        <div id="encrypt-result" class="mt-1 p-3 w-full rounded-md bg-gray-100 dark:bg-gray-700 result-box font-mono"></div>
                        <button id="download-encrypt-btn" class="hidden mt-2 w-full btn-primary bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700">Download Processed File</button>
                    </div>
                </div>
            </div>

            <!-- Swap Button -->
            <div class="my-4 lg:my-0">
                <button id="swap-btn" class="p-3 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 transform lg:rotate-0 rotate-90" title="Swap Content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-left-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"/></svg>
                </button>
            </div>

            <!-- Decryption Tool -->
            <div id="decrypt-container" class="w-full bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md tool-container">
                <h2 class="text-2xl font-bold mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">Decrypt / Decode</h2>
                <div class="space-y-4">
                    <div>
                        <label for="decrypt-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Text to Process:</label>
                        <textarea id="decrypt-text" rows="4" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>
                     <div>
                        <label for="decrypt-file-input" class="file-input-label block text-sm font-medium text-center text-green-600 dark:text-green-400 bg-green-100 dark:bg-gray-700 hover:bg-green-200 dark:hover:bg-gray-600">
                            Or Upload a File
                        </label>
                        <input type="file" id="decrypt-file-input" class="hidden">
                        <span id="decrypt-file-name" class="text-sm text-gray-500 dark:text-gray-400 mt-1 block"></span>
                    </div>
                    <div>
                        <label for="decrypt-method" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Method:</label>
                        <select id="decrypt-method" class="mt-1 block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <option value="caesar">Caesar Cipher</option>
                            <option value="substitution">Substitution Cipher</option>
                            <option value="vigenere">Vigenère Cipher</option>
                            <option value="atbash">Atbash Cipher</option>
                            <option value="morse">Morse Code</option>
                        </select>
                    </div>
                    <div id="decrypt-key-container">
                        <label for="decrypt-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Key (Shift for Caesar):</label>
                         <div class="flex items-center gap-2 mt-1">
                            <input type="text" id="decrypt-key" value="3" class="block w-full rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <button id="generate-decrypt-key" class="hidden p-2 rounded-md bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500" title="Generate Random Key">
                               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shuffle" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.261.43.392.86.392 1.29 0 .43-.13.86-.392 1.29a3.37 3.37 0 0 1-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A2.37 2.37 0 0 0 5.624 8.5c0-.596.246-1.15.658-1.568C7.173 5.01 8.548 4 10.348 4H15.5a.5.5 0 0 1 0 1h-5.152c-1.802 0-3.177 1.01-4.123 2.082a2.37 2.37 0 0 0-.657 1.568c0 .596.246 1.15.657 1.568C7.177 10.99 8.552 12 10.352 12H11.5a.5.5 0 0 1 0 1h-1.152c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 4.376 9.21c-.261-.43-.392-.86-.392-1.29 0 .43.13.86.392-1.29C4.938 6.19 5.312 5.64 5.803 5.088 6.757 4.01 8.132 3 10 3h.5a.5.5 0 0 1 0 1H10c-1.798 0-3.173-1.01-4.126 2.082A2.37 2.37 0 0 0 5.376 7.5c0 .596.246 1.15.658 1.568C6.827 9.99 8.202 11 10 11h.5a.5.5 0 0 1 0 1H10c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 4.002 8.71c-.261-.43-.392-.86-.392-1.29s.13-.86.392-1.29c.26-.43.635-.98 1.126-1.532C6.173 3.24 7.798 2 10 2h5.5a.5.5 0 0 1 0 1H10c-1.802 0-3.177 1.01-4.123 2.082A2.37 2.37 0 0 0 5.22 6.432c0 .596.246 1.15.657 1.568C6.723 8.99 8.098 10 9.898 10H15.5a.5.5 0 0 1 0 1h-5.602c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 3.898 7.21c-.261-.43-.392-.86-.392-1.29 0-.43.13-.86.392-1.29C4.158 4.19 4.532 3.64 5.024 3.088 5.977 2.01 7.352 1 9.152 1H15.5a.5.5 0 0 1 0 1h-6.348c-1.798 0-3.173-1.01-4.126 2.082A2.37 2.37 0 0 0 4.376 5.5c0 .596.246 1.15.658 1.568C5.827 7.99 7.202 9 9 9h.5a.5.5 0 0 1 0 1H9c-2.202 0-3.827-1.24-4.874-2.418A3.37 3.37 0 0 1 3.002 6.21c-.261-.43-.392-.86-.392-1.29s.13-.86.392-1.29C3.258 3.19 3.632 2.64 4.124 2.088 5.077 1.01 6.452 0 8.252 0H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V.5H8.252C6.452.5 5.077 1.51 4.124 2.582A2.37 2.37 0 0 0 3.468 4.15c-.246.412-.369.86-.369 1.35 0 .49.123.938.369 1.35a2.37 2.37 0 0 0 .656 1.568C5.077 9.49 6.452 10.5 8.252 10.5H9.5a.5.5 0 0 1 0 1h-1.248c-1.8 0-3.175-1.01-4.123-2.082a2.37 2.37 0 0 0-.657-1.568c-.246-.412-.369-.86-.369-1.35 0-.49.123-.938.369-1.35a2.37 2.37 0 0 0 .657-1.568C5.075 3.51 6.45 2.5 8.25 2.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V3.5h-7.25c-1.8 0-3.175-1.01-4.123 2.082A2.37 2.37 0 0 0 3.47 7.15c-.246.412-.369.86-.369 1.35 0 .49.123.938.369 1.35a2.37 2.37 0 0 0 .656 1.568C5.075 12.49 6.45 13.5 8.25 13.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-.5H8.25c-1.8 0-3.175-1.01-4.123-2.082A2.37 2.37 0 0 0 3.47 9.85c-.246-.412-.369-.86-.369-1.35 0-.49.123-.938.369-1.35a2.37 2.37 0 0 0 .656-1.568C5.075 5.51 6.45 4.5 8.25 4.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5h-7.25c-2.202 0-3.827 1.24-4.874 2.418A3.37 3.37 0 0 1 2.25 9.21c-.261.43-.392.86-.392-1.29 0 .43.13.86.392 1.29.26.43.635.98 1.126 1.532C4.173 14.76 5.798 16 8 16h7.5a.5.5 0 0 1 .5-.5v-1a.5.5 0 0 1 1 0v1a1.5 1.5 0 0 1-1.5 1.5H8c-2.761 0-4.764-1.67-5.952-3.048A4.37 4.37 0 0 1 .75 9.21c0-.615.17-1.215.5-1.756C2.125 6.01 3.927 4.5 6.5 4.5H15.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5H6.5c-2.573 0-4.375 1.51-5.25 2.956C.82 9.17.5 10.036.5 11a2.5 2.5 0 0 0 2.5 2.5h10.5a.5.5 0 0 1 0 1H3a3.5 3.5 0 0 1-3.5-3.5c0-1.18.34-2.274.968-3.218C1.453 6.01 3.251 4.5 6 4.5h9.5a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V5.5H6c-2.761 0-4.764-1.67-5.952-3.048A4.37 4.37 0 0 1 0 3.5z"/></svg>
                            </button>
                        </div>
                    </div>
                    <button id="decrypt-btn" class="w-full btn-primary bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Process
                    </button>
                    <div>
                        <div class="flex justify-between items-center">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Result:</label>
                             <button id="copy-decrypt" class="icon-btn text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" title="Copy to Clipboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                            </button>
                        </div>
                        <div id="decrypt-result" class="mt-1 p-3 w-full rounded-md bg-gray-100 dark:bg-gray-700 result-box font-mono"></div>
                        <button id="download-decrypt-btn" class="hidden mt-2 w-full btn-primary bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700">Download Processed File</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cryptanalysis Section -->
        <div class="max-w-7xl mx-auto mt-10">
            <div id="analysis-container" class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md tool-container">
                <h2 class="text-2xl font-bold mb-4 border-b border-gray-200 dark:border-gray-700 pb-2">Cryptanalysis Tools</h2>
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold">Letter Frequency Analysis</h3>
                    <p class="text-gray-600 dark:text-gray-400">
                        Analyze the text in the 'Decrypt / Decode' result box to see the frequency of each letter. This is a classic technique for breaking simple substitution ciphers. In English, 'E', 'T', and 'A' are the most common letters.
                    </p>
                    <button id="analyze-btn" class="btn-primary bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">
                        Analyze Decrypted Text
                    </button>
                    <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                        <canvas id="frequency-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DOM Elements ---
        const encryptText = document.getElementById('encrypt-text');
        const encryptMethod = document.getElementById('encrypt-method');
        const encryptKey = document.getElementById('encrypt-key');
        const encryptBtn = document.getElementById('encrypt-btn');
        const encryptResult = document.getElementById('encrypt-result');
        const encryptKeyContainer = document.getElementById('encrypt-key-container');
        const encryptFileInput = document.getElementById('encrypt-file-input');
        const encryptFileName = document.getElementById('encrypt-file-name');
        const downloadEncryptBtn = document.getElementById('download-encrypt-btn');
        const generateEncryptKeyBtn = document.getElementById('generate-encrypt-key');
        const copyEncryptBtn = document.getElementById('copy-encrypt');

        const decryptText = document.getElementById('decrypt-text');
        const decryptMethod = document.getElementById('decrypt-method');
        const decryptKey = document.getElementById('decrypt-key');
        const decryptBtn = document.getElementById('decrypt-btn');
        const decryptResult = document.getElementById('decrypt-result');
        const decryptKeyContainer = document.getElementById('decrypt-key-container');
        const decryptFileInput = document.getElementById('decrypt-file-input');
        const decryptFileName = document.getElementById('decrypt-file-name');
        const downloadDecryptBtn = document.getElementById('download-decrypt-btn');
        const generateDecryptKeyBtn = document.getElementById('generate-decrypt-key');
        const copyDecryptBtn = document.getElementById('copy-decrypt');

        const swapBtn = document.getElementById('swap-btn');
        
        const analyzeBtn = document.getElementById('analyze-btn');
        const frequencyChartCanvas = document.getElementById('frequency-chart').getContext('2d');
        let frequencyChart = null;

        // --- Global State ---
        let originalEncryptFileName = '';
        let originalDecryptFileName = '';

        // --- Constants ---
        const ALPHABET = 'abcdefghijklmnopqrstuvwxyz';
        const REVERSED_ALPHABET = 'zyxwvutsrqponmlkjihgfedcba';
        const MORSE_CODE_MAP = {
            'a': '.-', 'b': '-...', 'c': '-.-.', 'd': '-..', 'e': '.', 'f': '..-.', 'g': '--.', 'h': '....',
            'i': '..', 'j': '.---', 'k': '-.-', 'l': '.-..', 'm': '--', 'n': '-.', 'o': '---', 'p': '.--.',
            'q': '--.-', 'r': '.-.', 's': '...', 't': '-', 'u': '..-', 'v': '...-', 'w': '.--', 'x': '-..-',
            'y': '-.--', 'z': '--..', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....',
            '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
            '.': '.-.-.-', ',': '--..--', '?': '..--..', "'": '.----.', '!': '-.-.--', '/': '-..-.', '(': '-.--.', ')': '-.--.-',
            '&': '.-...', ':': '---...', ';': '-.-.-.', '=': '-...-', '+': '.-.-.', '-': '-....-', '_': '..--.-', '"': '.-..-.',
            '$': '...-..-', '@': '.--.-.'
        };
        const REVERSE_MORSE_CODE_MAP = Object.fromEntries(Object.entries(MORSE_CODE_MAP).map(([k, v]) => [v, k]));


        // --- Cipher Logic ---
        function caesarCipher(text, shift, encrypt = true) {
            shift = parseInt(shift);
            if (isNaN(shift)) return 'Error: Shift key must be a number.';
            shift = encrypt ? shift : -shift;
            return text.split('').map(char => {
                const lowerChar = char.toLowerCase();
                const index = ALPHABET.indexOf(lowerChar);
                if (index === -1) return char;
                let newIndex = (index + shift) % 26;
                if (newIndex < 0) newIndex += 26;
                const newChar = ALPHABET[newIndex];
                return char === lowerChar ? newChar : newChar.toUpperCase();
            }).join('');
        }

        function substitutionCipher(text, key, encrypt = true) {
            if (key.length !== 26 || new Set(key.toLowerCase()).size !== 26) {
                return 'Error: Substitution key must be 26 unique letters.';
            }
            const keyLower = key.toLowerCase();
            const fromAlphabet = encrypt ? ALPHABET : keyLower;
            const toAlphabet = encrypt ? keyLower : ALPHABET;
            return text.split('').map(char => {
                const lowerChar = char.toLowerCase();
                const index = fromAlphabet.indexOf(lowerChar);
                if (index === -1) return char;
                const newChar = toAlphabet[index];
                return char === lowerChar ? newChar : newChar.toUpperCase();
            }).join('');
        }
        
        function vigenereCipher(text, key, encrypt = true) {
            const sanitizedKey = key.toLowerCase().replace(/[^a-z]/g, '');
            if (sanitizedKey.length === 0) return 'Error: Vigenère key must contain letters.';
            let keyIndex = 0;
            return text.split('').map(char => {
                const lowerChar = char.toLowerCase();
                const charIndex = ALPHABET.indexOf(lowerChar);
                if (charIndex === -1) return char;
                
                const keyChar = sanitizedKey[keyIndex % sanitizedKey.length];
                const keyShift = ALPHABET.indexOf(keyChar);
                keyIndex++;

                const shift = encrypt ? keyShift : -keyShift;
                let newIndex = (charIndex + shift + 26) % 26;
                
                const newChar = ALPHABET[newIndex];
                return char === lowerChar ? newChar : newChar.toUpperCase();
            }).join('');
        }

        function atbashCipher(text) {
             return text.split('').map(char => {
                const lowerChar = char.toLowerCase();
                const index = ALPHABET.indexOf(lowerChar);
                if (index === -1) return char;
                const newChar = REVERSED_ALPHABET[index];
                return char === lowerChar ? newChar : newChar.toUpperCase();
            }).join('');
        }

        function morseCode(text, encode = true) {
            if (encode) {
                return text.toLowerCase().split('').map(char => {
                    if (char === ' ') return '/';
                    return MORSE_CODE_MAP[char] || '';
                }).join(' ').replace(/ +/g, ' ').trim();
            } else {
                return text.split(' / ').map(word => {
                    return word.split(' ').map(code => REVERSE_MORSE_CODE_MAP[code] || '').join('');
                }).join(' ');
            }
        }

        // --- Analysis Logic ---
        function calculateFrequency(text) {
            const frequencies = {};
            for (const letter of ALPHABET) {
                frequencies[letter] = 0;
            }
            for (const char of text.toLowerCase()) {
                if (ALPHABET.includes(char)) {
                    frequencies[char]++;
                }
            }
            return frequencies;
        }

        function displayFrequencyChart(frequencyData) {
            if (frequencyChart) {
                frequencyChart.destroy();
            }
            const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const labelColor = isDarkMode ? 'rgba(255, 255, 255, 0.7)' : 'rgba(0, 0, 0, 0.7)';

            frequencyChart = new Chart(frequencyChartCanvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(frequencyData),
                    datasets: [{
                        label: 'Letter Frequency',
                        data: Object.values(frequencyData),
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        },
                        x: {
                            ticks: { color: labelColor },
                            grid: { color: gridColor }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: labelColor }
                        }
                    }
                }
            });
        }


        // --- File Handling ---
        function handleFile(file, targetTextArea, targetFileName) {
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    targetTextArea.value = e.target.result;
                };
                reader.readAsText(file);
                targetFileName.textContent = `File: ${file.name}`;
            }
        }

        function downloadFile(content, originalName, mode) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${mode}-${originalName}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- UI Helpers ---
        function copyToClipboard(text) {
            if (!text) return;
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textArea);
        }

        function generateSubstitutionKey() {
            const alphabetArray = ALPHABET.split('');
            for (let i = alphabetArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [alphabetArray[i], alphabetArray[j]] = [alphabetArray[j], alphabetArray[i]];
            }
            return alphabetArray.join('');
        }

        // --- Event Listeners ---
        encryptFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            originalEncryptFileName = file ? file.name : '';
            handleFile(file, encryptText, encryptFileName);
            downloadEncryptBtn.classList.add('hidden');
        });

        decryptFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            originalDecryptFileName = file ? file.name : '';
            handleFile(file, decryptText, decryptFileName);
            downloadDecryptBtn.classList.add('hidden');
        });
        
        encryptBtn.addEventListener('click', () => {
            const text = encryptText.value;
            const method = encryptMethod.value;
            const key = encryptKey.value;
            let result = '';

            if (method === 'caesar') result = caesarCipher(text, key, true);
            else if (method === 'substitution') result = substitutionCipher(text, key, true);
            else if (method === 'vigenere') result = vigenereCipher(text, key, true);
            else if (method === 'atbash') result = atbashCipher(text);
            else if (method === 'morse') result = morseCode(text, true);
            
            encryptResult.textContent = result;

            if ((originalEncryptFileName || text) && result.indexOf('Error:') === -1) {
                downloadEncryptBtn.classList.remove('hidden');
            } else {
                downloadEncryptBtn.classList.add('hidden');
            }
        });

        decryptBtn.addEventListener('click', () => {
            const text = decryptText.value;
            const method = decryptMethod.value;
            const key = decryptKey.value;
            let result = '';

            if (method === 'caesar') result = caesarCipher(text, key, false);
            else if (method === 'substitution') result = substitutionCipher(text, key, false);
            else if (method === 'vigenere') result = vigenereCipher(text, key, false);
            else if (method === 'atbash') result = atbashCipher(text);
            else if (method === 'morse') result = morseCode(text, false);

            decryptResult.textContent = result;

            if ((originalDecryptFileName || text) && result.indexOf('Error:') === -1) {
                downloadDecryptBtn.classList.remove('hidden');
            } else {
                downloadDecryptBtn.classList.add('hidden');
            }
        });
        
        analyzeBtn.addEventListener('click', () => {
            const textToAnalyze = decryptResult.textContent;
            if (!textToAnalyze) {
                alert('There is no text in the decryption result box to analyze.');
                return;
            }
            const frequencies = calculateFrequency(textToAnalyze);
            displayFrequencyChart(frequencies);
        });

        downloadEncryptBtn.addEventListener('click', () => downloadFile(encryptResult.textContent, originalEncryptFileName || 'text.txt', 'processed'));
        downloadDecryptBtn.addEventListener('click', () => downloadFile(decryptResult.textContent, originalDecryptFileName || 'text.txt', 'processed'));
        copyEncryptBtn.addEventListener('click', () => copyToClipboard(encryptResult.textContent));
        copyDecryptBtn.addEventListener('click', () => copyToClipboard(decryptResult.textContent));
        swapBtn.addEventListener('click', () => {
            [encryptText.value, decryptText.value] = [decryptText.value, encryptText.value];
            [encryptResult.textContent, decryptResult.textContent] = [decryptResult.textContent, encryptResult.textContent];
        });
        generateEncryptKeyBtn.addEventListener('click', () => encryptKey.value = generateSubstitutionKey());
        generateDecryptKeyBtn.addEventListener('click', () => decryptKey.value = generateSubstitutionKey());

        // --- UI Updates for Key Input ---
        function updateKeyInput(methodSelect, keyInput, keyContainer, generateBtn) {
             const method = methodSelect.value;
             const label = keyContainer.querySelector('label');
             keyContainer.classList.remove('hidden'); // Show by default
             generateBtn.classList.add('hidden'); // Hide by default

             if (method === 'caesar') {
                label.textContent = 'Key (Shift Number):';
                keyInput.placeholder = 'e.g., 3';
                if(keyInput.value.length > 2 || isNaN(keyInput.value)) keyInput.value = '3';
             } else if (method === 'substitution') {
                label.textContent = 'Key (26-letter Alphabet):';
                keyInput.placeholder = 'e.g., qwertzuiopasdfghjklyxcvbnm';
                generateBtn.classList.remove('hidden');
                if(keyInput.value.length !== 26 || !/^[a-zA-Z]+$/.test(keyInput.value)) {
                    keyInput.value = 'qwertzuiopasdfghjklyxcvbnm';
                }
             } else if (method === 'vigenere') {
                label.textContent = 'Key (Keyword):';
                keyInput.placeholder = 'e.g., secret';
                if(!/^[a-zA-Z]+$/.test(keyInput.value) || keyInput.value.length > 26) keyInput.value = 'secret';
             } else if (method === 'atbash' || method === 'morse') {
                keyContainer.classList.add('hidden');
             }
        }

        encryptMethod.addEventListener('change', () => updateKeyInput(encryptMethod, encryptKey, encryptKeyContainer, generateEncryptKeyBtn));
        decryptMethod.addEventListener('change', () => updateKeyInput(decryptMethod, decryptKey, decryptKeyContainer, generateDecryptKeyBtn));
        
        // Initial setup
        updateKeyInput(encryptMethod, encryptKey, encryptKeyContainer, generateEncryptKeyBtn);
        updateKeyInput(decryptMethod, decryptKey, decryptKeyContainer, generateDecryptKeyBtn);

    </script>
</body>
</html>
